const request={url:"https://api.github.com/gists/",gistid:"5a5f8e0bd7caab45aa811d4616a846bd",filename:"list.json",ajax:()=>new Promise(e=>{$.ajax({url:request.url+request.gistid,type:"GET",dataType:"jsonp"}).done(a=>{const s=a.data.files[request.filename].content;storage.set(s),e(s)})})},storage={listItem:"list",cacheKey:"cacheKey",check:()=>{let e=localStorage.getItem(storage.cacheKey);if(e){(new Date).toLocaleDateString("fr-FR")!==e&&(e=null)}return e},set:e=>{const a=new Date;localStorage.setItem(storage.listItem,e),localStorage.setItem(storage.cacheKey,a.toLocaleDateString("fr-FR"))}},search={input:null,list:null,country:null,validator:/\s|\./g,getResult:(e,a)=>_.filter(e,e=>{return e.code.replaceAll(search.validator,"").includes(a)}),buildHtml:e=>{let a="";return e.length>0?e.forEach(e=>{a+=`<li>\n                <span class="name">\n                    <span class="code">${e.code}</span> <em>-</em> \n                    <span class="place">${e.place}</span>\n                </span>\n                <span class="type">\n                    <span class="${e.bovins?"":"disabled"}">B</span>\n                    <span class="${e.veaux?"":"disabled"}" >V</span>\n                    <span class="${e.ovins?"":"disabled"}">0</span>\n                    <span class="${e.caprin?"":"disabled"}">C</span>\n                </span>\n                </li>`}):a+="<li>Votre saisie ne correspond à aucun abattoir connu ayant recours à l'étourdissement.</li>",a},display:()=>{let e=(search.country+search.input.val()).replaceAll(search.validator,""),a="";return e!==search.country&&(a=search.buildHtml(search.getResult(search.list,e))),a},init:e=>{search.list=e,search.country=$("#country").val(),$("#code").on("input",e=>{search.input=$(e.currentTarget),$("#result").html(search.display())})}};$(document).ready(()=>{storage.check()?search.init(JSON.parse(localStorage.getItem(storage.listItem))):request.ajax().then(e=>{search.init(JSON.parse(e))}),$(".trigger").on("click",()=>{$(".info").toggleClass("open")})});